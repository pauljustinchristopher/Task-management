{"ast":null,"code":"import _objectSpread from\"C:/Users/paulj/Desktop/SIWES/defence project/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Container,Typography,Button,Grid,Card,CardContent,Chip,Box,Dialog,DialogTitle,DialogContent,TextField,DialogActions,MenuItem,IconButton,Menu,MenuItem as MenuItemComponent,Avatar,FormControl,InputLabel,Select,Tabs,Tab}from'@mui/material';import{Add as AddIcon,MoreVert as MoreVertIcon,Edit as EditIcon,Delete as DeleteIcon,Assignment as TaskIcon}from'@mui/icons-material';import{format}from'date-fns';import toast from'react-hot-toast';import{taskAPI,projectAPI}from'../services/apiServices';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Tasks=()=>{const[tasks,setTasks]=useState([]);const[projects,setProjects]=useState([]);const[loading,setLoading]=useState(true);const[openDialog,setOpenDialog]=useState(false);const[editingTask,setEditingTask]=useState(null);const[anchorEl,setAnchorEl]=useState(null);const[selectedTask,setSelectedTask]=useState(null);const[tabValue,setTabValue]=useState(0);const[formData,setFormData]=useState({title:'',description:'',project:'',status:'todo',priority:'medium',dueDate:''});useEffect(()=>{fetchTasks();fetchProjects();},[]);const fetchTasks=async()=>{try{const response=await taskAPI.getTasks();setTasks(response.data.data||[]);}catch(error){toast.error('Failed to fetch tasks');}finally{setLoading(false);}};const fetchProjects=async()=>{try{const response=await projectAPI.getProjects();setProjects(response.data.projects||[]);}catch(error){console.error('Failed to fetch projects');}};const handleCreateTask=()=>{setEditingTask(null);setFormData({title:'',description:'',project:'',status:'todo',priority:'medium',dueDate:''});setOpenDialog(true);};const handleEditTask=task=>{var _task$project;setEditingTask(task);setFormData({title:task.title,description:task.description,project:((_task$project=task.project)===null||_task$project===void 0?void 0:_task$project._id)||'',status:task.status,priority:task.priority,dueDate:task.dueDate?format(new Date(task.dueDate),'yyyy-MM-dd'):''});setOpenDialog(true);setAnchorEl(null);};const handleSubmit=async()=>{try{const taskData=_objectSpread(_objectSpread({},formData),{},{dueDate:formData.dueDate?new Date(formData.dueDate):null});if(editingTask){await taskAPI.updateTask(editingTask._id,taskData);toast.success('Task updated successfully');}else{await taskAPI.createTask(taskData);toast.success('Task created successfully');}setOpenDialog(false);fetchTasks();}catch(error){var _error$response,_error$response$data;toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'An error occurred');}};const handleDeleteTask=async taskId=>{if(window.confirm('Are you sure you want to delete this task?')){try{await taskAPI.deleteTask(taskId);toast.success('Task deleted successfully');fetchTasks();}catch(error){toast.error('Failed to delete task');}}setAnchorEl(null);};const getStatusColor=status=>{switch(status){case'completed':return'success';case'in-progress':return'primary';case'todo':return'warning';case'review':return'info';default:return'default';}};const getPriorityColor=priority=>{switch(priority){case'high':return'error';case'medium':return'warning';case'low':return'success';default:return'default';}};const filterTasksByStatus=status=>{if(status==='all')return tasks;return tasks.filter(task=>task.status===status);};const getTabTasks=()=>{const statusMap=['all','todo','in-progress','review','completed'];return filterTasksByStatus(statusMap[tabValue]);};return/*#__PURE__*/_jsxs(Container,{maxWidth:\"lg\",sx:{mt:4,mb:4},children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",mb:3,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",component:\"h1\",gutterBottom:true,children:\"Tasks\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:handleCreateTask,children:\"New Task\"})]}),/*#__PURE__*/_jsx(Box,{sx:{borderBottom:1,borderColor:'divider',mb:3},children:/*#__PURE__*/_jsxs(Tabs,{value:tabValue,onChange:(e,newValue)=>setTabValue(newValue),children:[/*#__PURE__*/_jsx(Tab,{label:\"All\"}),/*#__PURE__*/_jsx(Tab,{label:\"To Do\"}),/*#__PURE__*/_jsx(Tab,{label:\"In Progress\"}),/*#__PURE__*/_jsx(Tab,{label:\"Review\"}),/*#__PURE__*/_jsx(Tab,{label:\"Completed\"})]})}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:3,children:getTabTasks().map(task=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:4,children:/*#__PURE__*/_jsx(Card,{sx:{height:'100%',display:'flex',flexDirection:'column'},children:/*#__PURE__*/_jsxs(CardContent,{sx:{flexGrow:1},children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"space-between\",alignItems:\"flex-start\",mb:2,children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(Avatar,{sx:{mr:1,bgcolor:'primary.main'},children:/*#__PURE__*/_jsx(TaskIcon,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",component:\"h2\",children:task.title})]}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:e=>{setAnchorEl(e.currentTarget);setSelectedTask(task);},children:/*#__PURE__*/_jsx(MoreVertIcon,{})})]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",paragraph:true,children:task.description}),task.project&&/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"text.secondary\",display:\"block\",mb:1,children:[\"Project: \",task.project.name]}),/*#__PURE__*/_jsxs(Box,{mb:2,children:[/*#__PURE__*/_jsx(Chip,{label:task.status.replace('-',' ').toUpperCase(),color:getStatusColor(task.status),size:\"small\",sx:{mr:1}}),/*#__PURE__*/_jsx(Chip,{label:task.priority.toUpperCase(),color:getPriorityColor(task.priority),size:\"small\",variant:\"outlined\"})]}),task.dueDate&&/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"text.secondary\",children:[\"Due: \",format(new Date(task.dueDate),'MMM dd, yyyy')]}),task.assignedTo&&/*#__PURE__*/_jsxs(Box,{mt:1,display:\"flex\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"text.secondary\",mr:1,children:\"Assigned to:\"}),/*#__PURE__*/_jsx(Avatar,{sx:{width:24,height:24},children:task.assignedTo.name.charAt(0)})]})]})})},task._id))}),/*#__PURE__*/_jsxs(Menu,{anchorEl:anchorEl,open:Boolean(anchorEl),onClose:()=>setAnchorEl(null),children:[/*#__PURE__*/_jsxs(MenuItemComponent,{onClick:()=>handleEditTask(selectedTask),children:[/*#__PURE__*/_jsx(EditIcon,{sx:{mr:1},fontSize:\"small\"}),\"Edit\"]}),/*#__PURE__*/_jsxs(MenuItemComponent,{onClick:()=>handleDeleteTask(selectedTask===null||selectedTask===void 0?void 0:selectedTask._id),sx:{color:'error.main'},children:[/*#__PURE__*/_jsx(DeleteIcon,{sx:{mr:1},fontSize:\"small\"}),\"Delete\"]})]}),/*#__PURE__*/_jsxs(Dialog,{open:openDialog,onClose:()=>setOpenDialog(false),maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:editingTask?'Edit Task':'Create New Task'}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(TextField,{autoFocus:true,margin:\"dense\",label:\"Task Title\",fullWidth:true,variant:\"outlined\",value:formData.title,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{title:e.target.value})),sx:{mb:2}}),/*#__PURE__*/_jsx(TextField,{margin:\"dense\",label:\"Description\",fullWidth:true,multiline:true,rows:3,variant:\"outlined\",value:formData.description,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{description:e.target.value})),sx:{mb:2}}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,sx:{mb:2},children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Project\"}),/*#__PURE__*/_jsxs(Select,{value:formData.project,label:\"Project\",onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{project:e.target.value})),children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:\"No Project\"}),projects.map(project=>/*#__PURE__*/_jsx(MenuItem,{value:project._id,children:project.name},project._id))]})]}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:6,children:/*#__PURE__*/_jsxs(TextField,{select:true,label:\"Status\",fullWidth:true,value:formData.status,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{status:e.target.value})),children:[/*#__PURE__*/_jsx(MenuItem,{value:\"todo\",children:\"To Do\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"in-progress\",children:\"In Progress\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"review\",children:\"Review\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"completed\",children:\"Completed\"})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:6,children:/*#__PURE__*/_jsxs(TextField,{select:true,label:\"Priority\",fullWidth:true,value:formData.priority,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{priority:e.target.value})),children:[/*#__PURE__*/_jsx(MenuItem,{value:\"low\",children:\"Low\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"medium\",children:\"Medium\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"high\",children:\"High\"})]})})]}),/*#__PURE__*/_jsx(TextField,{margin:\"normal\",label:\"Due Date\",type:\"date\",fullWidth:true,InputLabelProps:{shrink:true},value:formData.dueDate,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{dueDate:e.target.value}))})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setOpenDialog(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleSubmit,variant:\"contained\",children:editingTask?'Update':'Create'})]})]})]});};export default Tasks;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}