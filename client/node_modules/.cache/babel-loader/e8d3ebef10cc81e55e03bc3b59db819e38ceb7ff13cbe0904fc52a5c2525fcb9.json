{"ast":null,"code":"import _objectSpread from\"C:/Users/paulj/Desktop/SIWES/defence project/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useParams,useNavigate,Link}from'react-router-dom';import{Container,Paper,TextField,Button,Typography,Box,Alert,CircularProgress,InputAdornment,IconButton,LinearProgress,Chip}from'@mui/material';import{Visibility,VisibilityOff,Lock,Check,Clear}from'@mui/icons-material';import{isValidPassword}from'../../utils/validation';import{authAPI}from'../../services/apiServices';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ResetPassword=()=>{const[formData,setFormData]=useState({password:'',confirmPassword:''});const[errors,setErrors]=useState({});const[showPassword,setShowPassword]=useState(false);const[showConfirmPassword,setShowConfirmPassword]=useState(false);const[passwordStrength,setPasswordStrength]=useState(0);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[success,setSuccess]=useState(false);const[validToken,setValidToken]=useState(null);const{token}=useParams();const navigate=useNavigate();useEffect(()=>{// Verify reset token on component mount\nconst verifyToken=async()=>{try{await authAPI.verifyResetToken(token);setValidToken(true);}catch(err){setValidToken(false);setError('Invalid or expired reset token. Please request a new password reset.');}};if(token){verifyToken();}else{setValidToken(false);setError('No reset token provided.');}},[token]);const getPasswordStrength=password=>{let strength=0;if(password.length>=8)strength+=1;if(/[a-z]/.test(password))strength+=1;if(/[A-Z]/.test(password))strength+=1;if(/[0-9]/.test(password))strength+=1;if(/[^A-Za-z0-9]/.test(password))strength+=1;return strength;};const getPasswordStrengthLabel=strength=>{switch(strength){case 0:case 1:return{label:'Very Weak',color:'error'};case 2:return{label:'Weak',color:'warning'};case 3:return{label:'Medium',color:'info'};case 4:return{label:'Strong',color:'success'};case 5:return{label:'Very Strong',color:'success'};default:return{label:'',color:'primary'};}};const handleChange=e=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));// Update password strength\nif(name==='password'){setPasswordStrength(getPasswordStrength(value));}// Clear field error when user starts typing\nif(errors[name]){setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:''}));}};const validateForm=()=>{const newErrors={};if(!formData.password){newErrors.password='Password is required';}else if(!isValidPassword(formData.password)){newErrors.password='Password must be at least 8 characters with uppercase, lowercase, number, and special character';}if(!formData.confirmPassword){newErrors.confirmPassword='Please confirm your password';}else if(formData.password!==formData.confirmPassword){newErrors.confirmPassword='Passwords do not match';}setErrors(newErrors);return Object.keys(newErrors).length===0;};const handleSubmit=async e=>{e.preventDefault();if(!validateForm()){return;}setLoading(true);setError('');try{await authAPI.resetPassword(token,formData.password);setSuccess(true);setTimeout(()=>{navigate('/login');},3000);}catch(err){var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'An error occurred. Please try again.');}finally{setLoading(false);}};const strengthInfo=getPasswordStrengthLabel(passwordStrength);if(validToken===null){return/*#__PURE__*/_jsx(Container,{component:\"main\",maxWidth:\"sm\",children:/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',mt:8},children:/*#__PURE__*/_jsx(CircularProgress,{})})});}if(validToken===false){return/*#__PURE__*/_jsx(Container,{component:\"main\",maxWidth:\"sm\",children:/*#__PURE__*/_jsx(Box,{sx:{marginTop:8,display:'flex',flexDirection:'column',alignItems:'center'},children:/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{padding:4,display:'flex',flexDirection:'column',alignItems:'center',width:'100%'},children:[/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h4\",gutterBottom:true,color:\"error\",children:\"Invalid Reset Token\"}),/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{width:'100%',mb:2},children:error}),/*#__PURE__*/_jsx(Box,{sx:{textAlign:'center',mt:2},children:/*#__PURE__*/_jsx(Link,{to:\"/forgot-password\",style:{textDecoration:'none',color:'#1976d2',fontWeight:'bold'},children:\"Request a new password reset\"})})]})})});}if(success){return/*#__PURE__*/_jsx(Container,{component:\"main\",maxWidth:\"sm\",children:/*#__PURE__*/_jsx(Box,{sx:{marginTop:8,display:'flex',flexDirection:'column',alignItems:'center'},children:/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{padding:4,display:'flex',flexDirection:'column',alignItems:'center',width:'100%'},children:[/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h4\",gutterBottom:true,color:\"success.main\",children:\"Password Reset Successful\"}),/*#__PURE__*/_jsx(Alert,{severity:\"success\",sx:{width:'100%',mb:2},children:\"Your password has been successfully reset. You will be redirected to the login page in a few seconds.\"}),/*#__PURE__*/_jsx(Box,{sx:{textAlign:'center',mt:2},children:/*#__PURE__*/_jsx(Link,{to:\"/login\",style:{textDecoration:'none',color:'#1976d2',fontWeight:'bold'},children:\"Go to Login now\"})})]})})});}return/*#__PURE__*/_jsx(Container,{component:\"main\",maxWidth:\"sm\",children:/*#__PURE__*/_jsx(Box,{sx:{marginTop:8,display:'flex',flexDirection:'column',alignItems:'center'},children:/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{padding:4,display:'flex',flexDirection:'column',alignItems:'center',width:'100%'},children:[/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h4\",gutterBottom:true,children:\"Reset Password\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",color:\"text.secondary\",sx:{mb:3,textAlign:'center'},children:\"Enter your new password below\"}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{width:'100%',mb:2},children:error}),/*#__PURE__*/_jsxs(Box,{component:\"form\",onSubmit:handleSubmit,sx:{mt:1,width:'100%'},children:[/*#__PURE__*/_jsx(TextField,{margin:\"normal\",required:true,fullWidth:true,name:\"password\",label:\"New Password\",type:showPassword?'text':'password',id:\"password\",autoComplete:\"new-password\",autoFocus:true,value:formData.password,onChange:handleChange,error:!!errors.password,helperText:errors.password,InputProps:{startAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"start\",children:/*#__PURE__*/_jsx(Lock,{})}),endAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"end\",children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"toggle password visibility\",onClick:()=>setShowPassword(!showPassword),edge:\"end\",children:showPassword?/*#__PURE__*/_jsx(VisibilityOff,{}):/*#__PURE__*/_jsx(Visibility,{})})})}}),formData.password&&/*#__PURE__*/_jsxs(Box,{sx:{mt:1,mb:2},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1,mb:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:\"Password Strength:\"}),/*#__PURE__*/_jsx(Chip,{label:strengthInfo.label,color:strengthInfo.color,size:\"small\",icon:passwordStrength>=4?/*#__PURE__*/_jsx(Check,{}):/*#__PURE__*/_jsx(Clear,{})})]}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:passwordStrength/5*100,color:strengthInfo.color,sx:{height:6,borderRadius:3}})]}),/*#__PURE__*/_jsx(TextField,{margin:\"normal\",required:true,fullWidth:true,name:\"confirmPassword\",label:\"Confirm New Password\",type:showConfirmPassword?'text':'password',id:\"confirmPassword\",autoComplete:\"new-password\",value:formData.confirmPassword,onChange:handleChange,error:!!errors.confirmPassword,helperText:errors.confirmPassword,InputProps:{startAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"start\",children:/*#__PURE__*/_jsx(Lock,{})}),endAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"end\",children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"toggle confirm password visibility\",onClick:()=>setShowConfirmPassword(!showConfirmPassword),edge:\"end\",children:showConfirmPassword?/*#__PURE__*/_jsx(VisibilityOff,{}):/*#__PURE__*/_jsx(Visibility,{})})})}}),/*#__PURE__*/_jsx(Button,{type:\"submit\",fullWidth:true,variant:\"contained\",sx:{mt:3,mb:2,py:1.5},disabled:loading,children:loading?/*#__PURE__*/_jsx(CircularProgress,{size:24}):'Reset Password'}),/*#__PURE__*/_jsx(Box,{sx:{textAlign:'center',mt:2},children:/*#__PURE__*/_jsx(Link,{to:\"/login\",style:{textDecoration:'none',color:'#1976d2',fontWeight:'bold'},children:\"Back to Login\"})})]})]})})});};export default ResetPassword;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}