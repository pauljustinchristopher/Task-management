{"ast":null,"code":"import _objectSpread from\"C:/Users/paulj/Desktop/SIWES/defence project/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import{Container,Typography,Box,Card,CardContent,Grid,Chip,Button,IconButton,TextField,MenuItem,Avatar,List,ListItem,ListItemText,ListItemAvatar,Divider,Dialog,DialogTitle,DialogContent,DialogActions,LinearProgress}from'@mui/material';import{ArrowBack as ArrowBackIcon,Edit as EditIcon,Save as SaveIcon,Cancel as CancelIcon,Comment as CommentIcon,Assignment as TaskIcon,Person as PersonIcon,Schedule as ScheduleIcon}from'@mui/icons-material';import{format}from'date-fns';import toast from'react-hot-toast';import{taskAPI,projectAPI}from'../services/apiServices';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const TaskDetail=()=>{const{id}=useParams();const navigate=useNavigate();const[task,setTask]=useState(null);const[projects,setProjects]=useState([]);const[loading,setLoading]=useState(true);const[editing,setEditing]=useState(false);const[formData,setFormData]=useState({title:'',description:'',status:'todo',priority:'medium',project:'',dueDate:''});const[comments,setComments]=useState([]);const[newComment,setNewComment]=useState('');useEffect(()=>{if(id){fetchTaskDetails();fetchProjects();}},[id]);const fetchTaskDetails=async()=>{try{var _taskData$project;const response=await taskAPI.getTask(id);const taskData=response.data;setTask(taskData);setFormData({title:taskData.title,description:taskData.description,status:taskData.status,priority:taskData.priority,project:((_taskData$project=taskData.project)===null||_taskData$project===void 0?void 0:_taskData$project._id)||'',dueDate:taskData.dueDate?format(new Date(taskData.dueDate),'yyyy-MM-dd'):''});// Mock comments for now\nsetComments([{id:1,user:{name:'John Doe',avatar:''},content:'This looks good. Let me review the implementation.',createdAt:new Date(Date.now()-2*60*60*1000)},{id:2,user:{name:'Jane Smith',avatar:''},content:'I have some suggestions for improvement.',createdAt:new Date(Date.now()-1*60*60*1000)}]);}catch(error){toast.error('Failed to fetch task details');navigate('/tasks');}finally{setLoading(false);}};const fetchProjects=async()=>{try{const response=await projectAPI.getProjects();setProjects(response.data.projects||[]);}catch(error){console.error('Failed to fetch projects');}};const handleSave=async()=>{try{const updateData=_objectSpread(_objectSpread({},formData),{},{dueDate:formData.dueDate?new Date(formData.dueDate):null});await taskAPI.updateTask(id,updateData);toast.success('Task updated successfully');setEditing(false);fetchTaskDetails();}catch(error){toast.error('Failed to update task');}};const handleCancel=()=>{var _task$project;setFormData({title:task.title,description:task.description,status:task.status,priority:task.priority,project:((_task$project=task.project)===null||_task$project===void 0?void 0:_task$project._id)||'',dueDate:task.dueDate?format(new Date(task.dueDate),'yyyy-MM-dd'):''});setEditing(false);};const handleStatusUpdate=async newStatus=>{try{await taskAPI.updateTask(id,{status:newStatus});toast.success('Task status updated');fetchTaskDetails();}catch(error){toast.error('Failed to update task status');}};const handleAddComment=()=>{if(newComment.trim()){// In a real app, this would make an API call\nconst comment={id:Date.now(),user:{name:'Current User',avatar:''},content:newComment,createdAt:new Date()};setComments([...comments,comment]);setNewComment('');toast.success('Comment added');}};const getStatusColor=status=>{switch(status){case'completed':return'success';case'in-progress':return'primary';case'todo':return'warning';case'review':return'info';default:return'default';}};const getPriorityColor=priority=>{switch(priority){case'high':return'error';case'medium':return'warning';case'low':return'success';default:return'default';}};if(loading){return/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsx(LinearProgress,{})});}if(!task){return/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:\"Task not found\"})});}return/*#__PURE__*/_jsxs(Container,{maxWidth:\"lg\",sx:{mt:4,mb:4},children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",mb:3,children:[/*#__PURE__*/_jsx(IconButton,{onClick:()=>navigate('/tasks'),sx:{mr:2},children:/*#__PURE__*/_jsx(ArrowBackIcon,{})}),/*#__PURE__*/_jsx(TaskIcon,{sx:{mr:2,color:'primary.main'}}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",component:\"h1\",sx:{flexGrow:1},children:editing?/*#__PURE__*/_jsx(TextField,{value:formData.title,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{title:e.target.value})),variant:\"standard\",fullWidth:true,sx:{fontSize:'2rem'}}):task.title}),!editing?/*#__PURE__*/_jsx(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(EditIcon,{}),onClick:()=>setEditing(true),children:\"Edit Task\"}):/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(SaveIcon,{}),onClick:handleSave,sx:{mr:1},children:\"Save\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(CancelIcon,{}),onClick:handleCancel,children:\"Cancel\"})]})]}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,md:8,children:[/*#__PURE__*/_jsx(Card,{sx:{mb:3},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Description\"}),editing?/*#__PURE__*/_jsx(TextField,{fullWidth:true,multiline:true,rows:4,value:formData.description,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{description:e.target.value})),variant:\"outlined\"}):/*#__PURE__*/_jsx(Typography,{variant:\"body1\",paragraph:true,children:task.description||'No description provided'})]})}),!editing&&/*#__PURE__*/_jsx(Card,{sx:{mb:3},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Quick Actions\"}),/*#__PURE__*/_jsx(Box,{display:\"flex\",gap:1,flexWrap:\"wrap\",children:['todo','in-progress','review','completed'].map(status=>/*#__PURE__*/_jsx(Button,{variant:task.status===status?\"contained\":\"outlined\",size:\"small\",onClick:()=>handleStatusUpdate(status),disabled:task.status===status,children:status.replace('-',' ').toUpperCase()},status))})]})}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",gutterBottom:true,children:[\"Comments (\",comments.length,\")\"]}),/*#__PURE__*/_jsxs(Box,{mb:3,children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,multiline:true,rows:2,placeholder:\"Add a comment...\",value:newComment,onChange:e=>setNewComment(e.target.value),variant:\"outlined\"}),/*#__PURE__*/_jsx(Box,{mt:1,display:\"flex\",justifyContent:\"flex-end\",children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:handleAddComment,disabled:!newComment.trim(),size:\"small\",children:\"Add Comment\"})})]}),/*#__PURE__*/_jsx(Divider,{sx:{mb:2}}),/*#__PURE__*/_jsx(List,{children:comments.map((comment,index)=>/*#__PURE__*/_jsxs(ListItem,{alignItems:\"flex-start\",children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:comment.user.name.charAt(0)})}),/*#__PURE__*/_jsx(ListItemText,{primary:/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",gap:1,children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",children:comment.user.name}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"text.secondary\",children:format(comment.createdAt,'PPp')})]}),secondary:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{mt:1},children:comment.content})})]},comment.id))})]})})]}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,md:4,children:[/*#__PURE__*/_jsx(Card,{sx:{mb:3},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Task Properties\"}),/*#__PURE__*/_jsxs(Box,{mb:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",gutterBottom:true,children:\"Status\"}),editing?/*#__PURE__*/_jsxs(TextField,{select:true,fullWidth:true,size:\"small\",value:formData.status,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{status:e.target.value})),children:[/*#__PURE__*/_jsx(MenuItem,{value:\"todo\",children:\"To Do\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"in-progress\",children:\"In Progress\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"review\",children:\"Review\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"completed\",children:\"Completed\"})]}):/*#__PURE__*/_jsx(Chip,{label:task.status.replace('-',' ').toUpperCase(),color:getStatusColor(task.status),size:\"small\"})]}),/*#__PURE__*/_jsxs(Box,{mb:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",gutterBottom:true,children:\"Priority\"}),editing?/*#__PURE__*/_jsxs(TextField,{select:true,fullWidth:true,size:\"small\",value:formData.priority,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{priority:e.target.value})),children:[/*#__PURE__*/_jsx(MenuItem,{value:\"low\",children:\"Low\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"medium\",children:\"Medium\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"high\",children:\"High\"})]}):/*#__PURE__*/_jsx(Chip,{label:task.priority.toUpperCase(),color:getPriorityColor(task.priority),size:\"small\",variant:\"outlined\"})]}),editing&&/*#__PURE__*/_jsxs(Box,{mb:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",gutterBottom:true,children:\"Project\"}),/*#__PURE__*/_jsxs(TextField,{select:true,fullWidth:true,size:\"small\",value:formData.project,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{project:e.target.value})),children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:\"No Project\"}),projects.map(project=>/*#__PURE__*/_jsx(MenuItem,{value:project._id,children:project.name},project._id))]})]}),/*#__PURE__*/_jsxs(Box,{mb:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",gutterBottom:true,children:\"Due Date\"}),editing?/*#__PURE__*/_jsx(TextField,{type:\"date\",fullWidth:true,size:\"small\",InputLabelProps:{shrink:true},value:formData.dueDate,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{dueDate:e.target.value}))}):task.dueDate?/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:format(new Date(task.dueDate),'PPP')}):/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:\"No due date set\"})]}),task.project&&/*#__PURE__*/_jsxs(Box,{mb:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",gutterBottom:true,children:\"Project\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{cursor:'pointer',color:'primary.main','&:hover':{textDecoration:'underline'}},onClick:()=>navigate(\"/projects/\".concat(task.project._id)),children:task.project.name})]}),task.assignedTo&&/*#__PURE__*/_jsxs(Box,{mb:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",gutterBottom:true,children:\"Assigned To\"}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(Avatar,{sx:{width:24,height:24,mr:1},children:task.assignedTo.name.charAt(0)}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:task.assignedTo.name})]})]})]})}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Timeline\"}),/*#__PURE__*/_jsx(Box,{mb:2,children:/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[\"Created: \",format(new Date(task.createdAt),'PPp')]})}),/*#__PURE__*/_jsx(Box,{mb:2,children:/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[\"Updated: \",format(new Date(task.updatedAt),'PPp')]})}),task.createdBy&&/*#__PURE__*/_jsx(Box,{mb:2,children:/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[\"Created by: \",task.createdBy.name]})})]})})]})]})]});};export default TaskDetail;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}