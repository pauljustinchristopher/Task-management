{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Container,Grid,Paper,Typography,Box,Card,CardContent,Avatar,Chip,LinearProgress,IconButton,Fab,useTheme}from'@mui/material';import{Assignment,People,TrendingUp,Schedule,Add,MoreVert,CheckCircle,AccessTime,Warning}from'@mui/icons-material';import{Line,Doughnut,Bar}from'react-chartjs-2';import{Chart as ChartJS,CategoryScale,LinearScale,PointElement,LineElement,Title,Tooltip,Legend,ArcElement,BarElement}from'chart.js';import{useAuth}from'../contexts/AuthContext';import{analyticsAPI,projectAPI,taskAPI}from'../services/apiServices';import{toast}from'react-hot-toast';// Register ChartJS components\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";ChartJS.register(CategoryScale,LinearScale,PointElement,LineElement,Title,Tooltip,Legend,ArcElement,BarElement);const Dashboard=()=>{var _dashboardData$produc,_dashboardData$produc2,_dashboardData$taskDi,_dashboardData$taskDi2,_dashboardData$taskDi3,_dashboardData$produc3;const[dashboardData,setDashboardData]=useState(null);const[recentProjects,setRecentProjects]=useState([]);const[recentTasks,setRecentTasks]=useState([]);const[loading,setLoading]=useState(true);const{user}=useAuth();const theme=useTheme();useEffect(()=>{fetchDashboardData();},[]);const fetchDashboardData=async()=>{try{const[dashboardRes,projectsRes,tasksRes]=await Promise.all([analyticsAPI.getDashboardAnalytics(),projectAPI.getProjects({limit:5,sort:'-updatedAt'}),taskAPI.getTasks({limit:10,sort:'-updatedAt'})]);setDashboardData(dashboardRes.data.data);// Note the nested data structure\nsetRecentProjects(projectsRes.data.projects||[]);setRecentTasks(tasksRes.data.data||[]);}catch(error){console.error('Error fetching dashboard data:',error);toast.error('Failed to load dashboard data');}finally{setLoading(false);}};const getTaskStatusColor=status=>{switch(status){case'completed':return'success';case'in-progress':return'warning';case'todo':return'default';default:return'default';}};const getTaskStatusIcon=status=>{switch(status){case'completed':return/*#__PURE__*/_jsx(CheckCircle,{});case'in-progress':return/*#__PURE__*/_jsx(AccessTime,{});case'todo':return/*#__PURE__*/_jsx(Schedule,{});default:return/*#__PURE__*/_jsx(Schedule,{});}};const getPriorityColor=priority=>{switch(priority){case'high':return'error';case'medium':return'warning';case'low':return'success';default:return'default';}};// Chart configurations\nconst productivityChartData={labels:(dashboardData===null||dashboardData===void 0?void 0:(_dashboardData$produc=dashboardData.productivity)===null||_dashboardData$produc===void 0?void 0:_dashboardData$produc.labels)||[],datasets:[{label:'Tasks Completed',data:(dashboardData===null||dashboardData===void 0?void 0:(_dashboardData$produc2=dashboardData.productivity)===null||_dashboardData$produc2===void 0?void 0:_dashboardData$produc2.data)||[],borderColor:theme.palette.primary.main,backgroundColor:theme.palette.primary.light,tension:0.4}]};const taskDistributionData={labels:['To Do','In Progress','Completed'],datasets:[{data:[(dashboardData===null||dashboardData===void 0?void 0:(_dashboardData$taskDi=dashboardData.taskDistribution)===null||_dashboardData$taskDi===void 0?void 0:_dashboardData$taskDi.todo)||0,(dashboardData===null||dashboardData===void 0?void 0:(_dashboardData$taskDi2=dashboardData.taskDistribution)===null||_dashboardData$taskDi2===void 0?void 0:_dashboardData$taskDi2.inProgress)||0,(dashboardData===null||dashboardData===void 0?void 0:(_dashboardData$taskDi3=dashboardData.taskDistribution)===null||_dashboardData$taskDi3===void 0?void 0:_dashboardData$taskDi3.completed)||0],backgroundColor:[theme.palette.grey[400],theme.palette.warning.main,theme.palette.success.main]}]};const projectProgressData={labels:recentProjects.map(p=>p.name)||[],datasets:[{label:'Progress %',data:recentProjects.map(p=>p.progress)||[],backgroundColor:theme.palette.primary.main}]};const chartOptions={responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'top'}}};if(loading){return/*#__PURE__*/_jsx(Container,{maxWidth:\"xl\",sx:{mt:4,mb:4},children:/*#__PURE__*/_jsx(Grid,{container:true,spacing:3,children:[1,2,3,4].map(item=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Paper,{sx:{p:2,height:140},children:/*#__PURE__*/_jsx(LinearProgress,{})})},item))})});}return/*#__PURE__*/_jsxs(Container,{maxWidth:\"xl\",sx:{mt:4,mb:4},children:[/*#__PURE__*/_jsxs(Box,{sx:{mb:4},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h4\",gutterBottom:true,children:[\"Welcome back, \",user===null||user===void 0?void 0:user.firstName,\"! \\uD83D\\uDC4B\"]}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",color:\"text.secondary\",children:\"Here's what's happening with your projects today.\"})]}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,sx:{mb:4},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:'primary.main',mr:2},children:/*#__PURE__*/_jsx(Assignment,{})}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",gutterBottom:true,children:\"Total Projects\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h5\",children:(dashboardData===null||dashboardData===void 0?void 0:dashboardData.totalProjects)||0})]})]})})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:'success.main',mr:2},children:/*#__PURE__*/_jsx(CheckCircle,{})}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",gutterBottom:true,children:\"Completed Tasks\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h5\",children:(dashboardData===null||dashboardData===void 0?void 0:dashboardData.completedTasks)||0})]})]})})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:'warning.main',mr:2},children:/*#__PURE__*/_jsx(People,{})}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",gutterBottom:true,children:\"Team Members\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h5\",children:(dashboardData===null||dashboardData===void 0?void 0:dashboardData.teamMembers)||0})]})]})})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:'info.main',mr:2},children:/*#__PURE__*/_jsx(TrendingUp,{})}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",gutterBottom:true,children:\"Productivity\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"h5\",children:[(dashboardData===null||dashboardData===void 0?void 0:(_dashboardData$produc3=dashboardData.productivity)===null||_dashboardData$produc3===void 0?void 0:_dashboardData$produc3.current)||0,\"%\"]})]})]})})})})]}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,sx:{mb:4},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:8,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:3,height:400},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Productivity Trend\"}),/*#__PURE__*/_jsx(Box,{sx:{height:300},children:/*#__PURE__*/_jsx(Line,{data:productivityChartData,options:chartOptions})})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:3,height:400},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Task Distribution\"}),/*#__PURE__*/_jsx(Box,{sx:{height:300},children:/*#__PURE__*/_jsx(Doughnut,{data:taskDistributionData,options:chartOptions})})]})})]}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,lg:6,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:3},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Recent Projects\"}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",children:/*#__PURE__*/_jsx(MoreVert,{})})]}),recentProjects.map(project=>{var _project$members,_project$members2;return/*#__PURE__*/_jsx(Card,{sx:{mb:2,'&:last-child':{mb:0}},children:/*#__PURE__*/_jsxs(CardContent,{sx:{pb:'16px !important'},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'flex-start',mb:2},children:[/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:project.name}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:project.description})]}),/*#__PURE__*/_jsx(Chip,{label:project.status,color:project.status==='active'?'success':'default',size:\"small\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',mb:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:\"Progress\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[project.progress,\"%\"]})]}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:project.progress,sx:{height:6,borderRadius:3}})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',mr:2},children:[(_project$members=project.members)===null||_project$members===void 0?void 0:_project$members.slice(0,3).map((member,index)=>{var _member$firstName,_member$lastName;return/*#__PURE__*/_jsxs(Avatar,{src:member.avatar,sx:{width:24,height:24,ml:index>0?-1:0,border:2,borderColor:'background.paper'},children:[(_member$firstName=member.firstName)===null||_member$firstName===void 0?void 0:_member$firstName[0],(_member$lastName=member.lastName)===null||_member$lastName===void 0?void 0:_member$lastName[0]]},member._id);}),((_project$members2=project.members)===null||_project$members2===void 0?void 0:_project$members2.length)>3&&/*#__PURE__*/_jsxs(Avatar,{sx:{width:24,height:24,ml:-1,fontSize:'0.7rem'},children:[\"+\",project.members.length-3]})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[\"Due \",new Date(project.endDate).toLocaleDateString()]})]})]})},project._id);})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,lg:6,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:3},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Recent Tasks\"}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",children:/*#__PURE__*/_jsx(MoreVert,{})})]}),recentTasks.map(task=>{var _task$assignee$firstN,_task$assignee$lastNa,_task$assignee,_task$assignee2;return/*#__PURE__*/_jsx(Card,{sx:{mb:2,'&:last-child':{mb:0}},children:/*#__PURE__*/_jsx(CardContent,{sx:{pb:'16px !important'},children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'flex-start',gap:2},children:[/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:getTaskStatusColor(task.status)+'.main'},children:getTaskStatusIcon(task.status)}),/*#__PURE__*/_jsxs(Box,{sx:{flexGrow:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",gutterBottom:true,children:task.title}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",sx:{mb:1},children:task.description}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1,mb:1},children:[/*#__PURE__*/_jsx(Chip,{label:task.priority,color:getPriorityColor(task.priority),size:\"small\"}),/*#__PURE__*/_jsx(Chip,{label:task.status,color:getTaskStatusColor(task.status),size:\"small\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[task.assignee&&/*#__PURE__*/_jsxs(Avatar,{src:task.assignee.avatar,sx:{width:24,height:24,mr:1},children:[(_task$assignee$firstN=task.assignee.firstName)===null||_task$assignee$firstN===void 0?void 0:_task$assignee$firstN[0],(_task$assignee$lastNa=task.assignee.lastName)===null||_task$assignee$lastNa===void 0?void 0:_task$assignee$lastNa[0]]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[(_task$assignee=task.assignee)===null||_task$assignee===void 0?void 0:_task$assignee.firstName,\" \",(_task$assignee2=task.assignee)===null||_task$assignee2===void 0?void 0:_task$assignee2.lastName]})]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:new Date(task.dueDate).toLocaleDateString()})]})]})]})})},task._id);})]})})]}),recentProjects.length>0&&/*#__PURE__*/_jsx(Grid,{container:true,spacing:3,sx:{mt:2},children:/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:3,height:400},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Project Progress Overview\"}),/*#__PURE__*/_jsx(Box,{sx:{height:300},children:/*#__PURE__*/_jsx(Bar,{data:projectProgressData,options:chartOptions})})]})})}),/*#__PURE__*/_jsx(Fab,{color:\"primary\",\"aria-label\":\"add\",sx:{position:'fixed',bottom:16,right:16},children:/*#__PURE__*/_jsx(Add,{})})]});};export default Dashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}